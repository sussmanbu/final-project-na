<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MA [46]15 Final Project — TEAM 14 - Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project — TEAM 14</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html" rel="" target="">
 <span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./analysis.html" rel="" target="">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./data.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-background" id="toc-data-background" class="nav-link active" data-scroll-target="#data-background">Data Background</a>
  <ul class="collapse">
  <li><a href="#data-source-and-reasons-to-collect-it" id="toc-data-source-and-reasons-to-collect-it" class="nav-link" data-scroll-target="#data-source-and-reasons-to-collect-it">Data source and reasons to collect it</a></li>
  <li><a href="#issues-on-how-the-data-was-collected" id="toc-issues-on-how-the-data-was-collected" class="nav-link" data-scroll-target="#issues-on-how-the-data-was-collected">Issues on how the data was collected</a></li>
  <li><a href="#samples-biases" id="toc-samples-biases" class="nav-link" data-scroll-target="#samples-biases">Sample’s biases</a></li>
  <li><a href="#the-purpose-about-the-data" id="toc-the-purpose-about-the-data" class="nav-link" data-scroll-target="#the-purpose-about-the-data">The purpose about the data</a></li>
  </ul></li>
  <li><a href="#data-loading-mergingand-cleaning" id="toc-data-loading-mergingand-cleaning" class="nav-link" data-scroll-target="#data-loading-mergingand-cleaning">Data Loading, Merging,and Cleaning</a>
  <ul class="collapse">
  <li><a href="#merging-datasets" id="toc-merging-datasets" class="nav-link" data-scroll-target="#merging-datasets">Merging Datasets</a></li>
  </ul></li>
  <li><a href="#variables-description" id="toc-variables-description" class="nav-link" data-scroll-target="#variables-description">Variables Description</a></li>
  <li><a href="#top-10-crime-categories-description" id="toc-top-10-crime-categories-description" class="nav-link" data-scroll-target="#top-10-crime-categories-description">Top 10 crime categories description</a>
  <ul class="collapse">
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages">R packages</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="images/general-view-nypd-arm-patch-26440914.webp" class="img-fluid"></p>
<section id="data-background" class="level2">
<h2 class="anchored" data-anchor-id="data-background">Data Background</h2>
<section id="data-source-and-reasons-to-collect-it" class="level3">
<h3 class="anchored" data-anchor-id="data-source-and-reasons-to-collect-it">Data source and reasons to collect it</h3>
<p>This datasets comes from the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u/about_data">NYC Opendata</a> and is collected by the Office of Management Analysis and Planning of the New York City Police Department. This dataset provides a general overview of individuals arrested by the NYPD in 2023.</p>
<p>The NYPD’s initiative to collect and disseminate data on crime rates and police enforcement activities is a multifaceted strategy aimed at enhancing public safety, ensuring transparency, and fostering community trust. This effort not only serves to keep the public informed about the safety of their neighborhoods but also aids the police department in strategic planning and efficient resource allocation. By analyzing crime trends, the NYPD can deploy resources more effectively, targeting areas with higher crime rates or specific types of criminal activities. Furthermore, making such data accessible supports policy making and evaluation, enabling lawmakers to craft and assess laws and policies with an eye toward crime reduction. Additionally, this transparency encourages community engagement and collaboration, as residents become more aware of the challenges their communities face and are thus more likely to work alongside the police to develop strategies for crime prevention. In sum, the NYPD’s collection and sharing of this dataset are integral to its broader objectives of improving public safety, enhancing operational efficiency, and building a collaborative relationship with the communities it serves.</p>
</section>
<section id="issues-on-how-the-data-was-collected" class="level3">
<h3 class="anchored" data-anchor-id="issues-on-how-the-data-was-collected">Issues on how the data was collected</h3>
<p>The collection of NYPD Arrest Data raises several concerns regarding its collection and subsequent analysis. Reporting biases might result from inconsistencies in how incidents are documented across different precincts or by individual officers, affecting data uniformity and reliability. Human error in data entry could introduce inaccuracies, including misclassifications or incorrect demographic information, which could mislead analyses, particularly in trend or demographic studies.</p>
</section>
<section id="samples-biases" class="level3">
<h3 class="anchored" data-anchor-id="samples-biases">Sample’s biases</h3>
<p>There might be some biases in the sample. In the dataset, certain age groups are disproportionately represented.Over representation of the 25-44 age group and certain racial demographics suggests possible targeted enforcement or societal issues, which could bias data-driven analyses. Additionally, the dataset disproportionately represents certain demographics in terms of race.</p>
</section>
<section id="the-purpose-about-the-data" class="level3">
<h3 class="anchored" data-anchor-id="the-purpose-about-the-data">The purpose about the data</h3>
<p>The NYPD’s data collection and dissemination initiative aims to improve public safety, enhance transparency, and build community trust. By providing crime rate and police activity data, the NYPD can better allocate resources, target high-crime areas, and support informed policymaking. This transparency also promotes community engagement, empowering residents to collaborate with the police in developing crime prevention strategies. Overall, this initiative supports the NYPD’s goals of enhancing safety, operational efficiency, and community collaboration.</p>
</section>
</section>
<section id="data-loading-mergingand-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-loading-mergingand-cleaning">Data Loading, Merging,and Cleaning</h2>
<section id="merging-datasets" class="level3">
<h3 class="anchored" data-anchor-id="merging-datasets">Merging Datasets</h3>
<p>In our research, in addition to the explantory analysis of arrest data, we wanted to take it a step further and look at the non-human factors that affect crime, so we added the daily weather conditions of New York City over the course of a year to our master data. This data comes from <a href="https://www.visualcrossing.com/weather/weather-data-services#">Visual crossing</a>’s weather database.</p>
<p>We selected basic weather conditions for New York City for the year 2023 so that we could explore whether extremes in temperature, wind speed, etc, affect crime rates, as well as crime trends under different weather conditions. This way it can be more efficient to optimize the efficiency of NYPD’s police response.</p>
<p>The merging process codes will shows in following load and cleaning script.</p>
<p><a href="scripts/load_and_clean_data.R">Data Loading and Cleaning Script</a></p>
<p>In the cleaning of the crime dataset, we delete the arrest ID, two police classification ID, jurisdiction code, and four coordinate variables . These variables are redundant and not relevant with our research. Then, We remove rows with any NA and null values from the dataset. We also delete undefined data in Level of offense: felony, misdemeanor, violation, infraction, besides that, we deleted the race recorded as unknown.</p>
<p>In the cleaning of the weather dataset, we just keep the date, daily temperature, windspeed, and keywords of daily weather conditions. following the same steps, we clean all the missing value and merge it with the arrest dataset. We merging two datasets based on their date columns, ensuring that all entries from the weather dataset are included and correspond with the crime dataset</p>
<p>All in all, it have 226244 rows and 13 columns. Below part shows the modified variables table.</p>
</section>
</section>
<section id="variables-description" class="level2">
<h2 class="anchored" data-anchor-id="variables-description">Variables Description</h2>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">Variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">Data_Types</th>
<th data-quarto-table-cell-role="th" style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">ARREST_DATE</td>
<td style="text-align: left;">calendar date</td>
<td style="text-align: left;">Exact date of arrest for the reported event</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">PD_DESC</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Description of internal classification corresponding with PD code (more granular than Offense Description)</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">OFNS_DESC</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Description of internal classification corresponding with KY code (more general category than PD description)</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">LAW_CAT_CD</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Level of offense: felony, misdemeanor, violation, infraction</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">ARREST_BORO</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Borough of arrest. B(Bronx), S(Staten Island), K(Brooklyn), M(Manhattan), Q(Queens)</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">ARREST_PRECINCT</td>
<td style="text-align: left;">number</td>
<td style="text-align: left;">Precinct where the arrest occurred</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">AGE_GROUP</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Perpetrator’s age within a category</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">PERP_SEX</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Perpetrator’s sex description</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">PERP_RACE</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Perpetrator’s race description</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">temp</td>
<td style="text-align: left;">number</td>
<td style="text-align: left;">Average Daily temperature in Celsius</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">windspeed</td>
<td style="text-align: left;">number</td>
<td style="text-align: left;">Daily Windspeed in Kilometer</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">conditons</td>
<td style="text-align: left;">text</td>
<td style="text-align: left;">Short description about the weather</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="top-10-crime-categories-description" class="level2">
<h2 class="anchored" data-anchor-id="top-10-crime-categories-description">Top 10 crime categories description</h2>
<p>There are 62 crimes, the below table shows the specific description and level of the top 10 crimes in order of the incident number.</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">OFNS_DESC</th>
<th data-quarto-table-cell-role="th" style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">PD_DESC_Details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">ASSAULT 3 &amp; RELATED OFFENSES</td>
<td style="text-align: left;">ASSAULT 3, MENACING,UNCLASSIFIED, OBSTR BREATH/CIRCUL</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">PETIT LARCENY</td>
<td style="text-align: left;">LARCENY,PETIT FROM OPEN AREAS,, LARCENY,PETIT BY ACQUIRING LOS</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">FELONY ASSAULT</td>
<td style="text-align: left;">STRANGULATION 1ST, ASSAULT 2,1,UNCLASSIFIED, ASSAULT POLICE/PEACE OFFICER</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">DANGEROUS DRUGS</td>
<td style="text-align: left;">CONTROLLED SUBSTANCE,POSSESS., CONTROLLED SUBSTANCE, POSSESSI, CONTROLLED SUBSTANCE,INTENT TO, CONTROLLED SUBSTANCE, SALE 4, CONTROLLED SUBSTANCE,SALE 3, CONTROLLED SUBSTANCE, INTENT T, CONTROLLED SUBSTANCE,SALE 1, DRUG PARAPHERNALIA, POSSESSE, SALE SCHOOL GROUNDS, CONTROLLED SUBSTANCE,SALE 2, POSS METH MANUFACT MATERIAL, CONTROLLED SUBSTANCE, SALE 5, SALES OF PRESCRIPTION, SALE SCHOOL GROUNDS 4</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">MISCELLANEOUS PENAL LAW</td>
<td style="text-align: left;">PUBLIC ADMINISTRATION,UNCLASSI, CRIMINAL CONTEMPT 1, MENACING 1ST DEGREE (VICT NOT, RECKLESS ENDANGERMENT 1, IMPERSONATION 1, POLICE OFFICE, AGGRAVATED CRIMINAL CONTEMPT, BRIBERY,PUBLIC ADMINISTRATION, FORGERY-ILLEGAL POSSESSION,VEH, VEHICULAR ASSAULT (INTOX DRIVE, BAIL JUMPING 1 &amp; 2, MAKING TERRORISTIC THREAT, AGGRAVATED HARASSMENT 1, TRESPASS 4,CRIMINAL SUB 2, UNAUTHORIZED USE VEHICLE 2, CONSPIRACY 4, 3, THEFT OF SERVICES- CABLE TV SE, SOLICITATION 3,2,1, CRIMINAL, TRESPASS 1,CRIMINAL, PROMOTING A SEXUAL PERFORMANCE, ESCAPE 2,1, FALSE REPORT 1,FIRE, BRIBERY,FRAUD, CONSPIRACY 2, 1, COERCION 1, TAMPERING WITH A WITNESS, FACILITATION 3,2,1, CRIMINAL, POSTING ADVERTISEMENTS, EXPOSURE OF A PERSON, USURY,CRIMINAL, ENTERPRISE CORRUPTION, USE OF A CHILD IN A SEXUAL PER, SUPP. ACT TERR 2ND, PERJURY 2,1,ETC, END WELFARE VULNERABLE ELDERLY PERSON, RIOT 1, FIREWORKS, POSSESS/USE, NUISANCE, CRIMINAL</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">VEHICLE AND TRAFFIC LAWS</td>
<td style="text-align: left;">TRAFFIC,UNCLASSIFIED MISDEMEAN, LEAVING SCENE-ACCIDENT-PERSONA, RECKLESS DRIVING</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">ROBBERY</td>
<td style="text-align: left;">ROBBERY,OPEN AREA UNCLASSIFIED, ROBBERY,CAR JACKING, ROBBERY,GAS STATION</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">CRIMINAL MISCHIEF &amp; RELATED OF</td>
<td style="text-align: left;">CRIMINAL MISCHIEF,UNCLASSIFIED 4, CRIMINAL MIS 2 &amp; 3, CRIMINAL MISCHIEF 4TH, GRAFFIT, MISCHIEF,CRIMINAL, UNCL 2ND, MISCHIEF 1,CRIMINAL,EXPLOSIVE, TAMPERING 3,2, CRIMINAL, TAMPERING 1,CRIMINAL, MISCHIEF, CRIMINAL 4, BY FIRE, RECKLESS ENDANGERMENT OF PROPE, FALSE ALARM FIRE, MISCHIEF, CRIMINAL 4, OF MOTOR, MISCHIEF, CRIMINAL 3 &amp; 2, OF M</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: black !important;">GRAND LARCENY</td>
<td style="text-align: left;">LARCENY,GRAND FROM PERSON,UNCL, LARCENY,GRAND FROM OPEN AREAS, UNATTENDED, AGGRAVATED GRAND LARCENY OF ATM, LARCENY,GRAND BY EXTORTION, LARCENY,GRAND BY THEFT OF CREDIT CARD, LARCENY,GRAND FROM BUILDING (NON-RESIDENCE) UNATTENDED</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; color: black !important;">DANGEROUS WEAPONS</td>
<td style="text-align: left;">CRIMINAL POSSESSION WEAPON, WEAPONS, POSSESSION, ETC, WEAPONS POSSESSION 3, CRIMINAL DISPOSAL FIREARM 1, MANUFATURE, TRANSPORT, DEFACE, ETC..., CRIM POS WEAP 4, WEAPONS,MFR,TRANSPORT,ETC., WEAPONS DISPOSITION OF, UNFINSH FRAME 2, FIREARMS LICENSING LAWS</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<section id="r-packages" class="level3">
<h3 class="anchored" data-anchor-id="r-packages">R packages</h3>
<p>These are the following new packages were used in making this project. kableExtra data.table magrittr knitr install.packages(“corrplot”)</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>