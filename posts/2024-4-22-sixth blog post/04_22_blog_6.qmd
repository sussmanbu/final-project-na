---
title: "Sixth Blog Post"
subtitle: ""
author: "TEAM 14"
date: "2024-04-22"
draft: false
---

We imported the Google Maps api to create heat maps to analyze where the highest amount of crime is in NYC, and also broke down the distribution of the top three crime categories in NYC.


Temporary Thesis: the Crime rate of Assault 3 will increase as temperature rises in the New York City.


```{r include=FALSE}
library(dplyr)
library(tidyverse) 
library(ggplot2)
library(dplyr)
library(kableExtra)
library(ggcorrplot)
library(ggmap)
library(leaflet)
library(patchwork)
library(tigris)
library(sp)
library(sf)
library(data.table)
library(lubridate)

ds <- read_rds("dataset/load_and_clean_data.rds")
```



We found that when season changes from summer to winter, the crime density gradually decreases.

```{r echo=FALSE, message=FALSE, warning= FALSE}
ds <- readRDS("dataset/load_and_clean_data.rds")
ds <- as.data.table(ds)
ds$ARREST_DATE <- ymd(ds$ARREST_DATE)
ds$ARREST_month <- month(ds$ARREST_DATE)

ds_sub <- ds[OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES",]
ds_sub_winter <- ds[OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES"&ARREST_month %in%c(1,2,12) ,]
ds_sub_summer <- ds[OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES"&ARREST_month %in%c(6,7,8) ,]
ds_sub_low <-ds[OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES"& temp<14.8 ,]
ds_sub_high <-ds[OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES"& temp>14.8 ,]

ds_plot <- ds_sub[,.(count = .N),ARREST_PRECINCT ]
ds_plot_winter <- ds_sub_winter[,.(count = .N),ARREST_PRECINCT ]
ds_plot_summer <-ds_sub_summer[,.(count = .N),ARREST_PRECINCT ]
ds_plot_low <- ds_sub_low[,.(count = .N),ARREST_PRECINCT ]
ds_plot_high <- ds_sub_high[,.(count = .N),ARREST_PRECINCT ]


map_data <- st_read("dataset/geo_export_87553334-fdcd-4d0c-8ab2-43a5e2975733.shp")
map_data <-as(map_data, "Spatial")
map_data_all <- sp::merge(map_data,ds_plot,by.x = "precinct",by.y ="ARREST_PRECINCT",all.x = T)
map_data_winter <- sp::merge(map_data,ds_plot_winter,by.x = "precinct",by.y ="ARREST_PRECINCT",all.x = T)
map_data_summer <- sp::merge(map_data,ds_plot_summer,by.x = "precinct",by.y ="ARREST_PRECINCT",all.x = T)
map_data_low <- sp::merge(map_data,ds_plot_low,by.x = "precinct",by.y ="ARREST_PRECINCT",all.x = T)
map_data_high <- sp::merge(map_data,ds_plot_high,by.x = "precinct",by.y ="ARREST_PRECINCT",all.x = T)


map_data_all <- as(map_data_all, "sf")
map_data_winter <- as(map_data_winter, "sf")
map_data_summer <-as(map_data_summer, "sf")
map_data_low <-as(map_data_low, "sf")
map_data_high  <-as(map_data_high , "sf")
```


```{r echo=FALSE, message=FALSE, warning= FALSE}
ggplot()+
  geom_sf(data = map_data_all,colour = "gray60",size = 0.1,aes(fill = count) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_distiller(palette = "YlOrRd",direction= 1) +
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("ALL YEAR")+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=FALSE, message=FALSE, warning= FALSE}
ggplot()+
  geom_sf(data = map_data_winter,colour = "gray60",size = 0.1,aes(fill = count) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_distiller(palette = "YlOrRd",direction= 1) +
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("winter")+
  theme(plot.title = element_text(hjust = 0.5))
```


```{r echo=FALSE, message=FALSE, warning= FALSE}
ggplot()+
  geom_sf(data = map_data_summer,colour = "gray60",size = 0.1,aes(fill = count) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_distiller(palette = "YlOrRd",direction= 1) +
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("summer")+
  theme(plot.title = element_text(hjust = 0.5))
```
```{r echo=FALSE, message=FALSE, warning= FALSE}
ggplot()+
  geom_sf(data = map_data_low,colour = "gray60",size = 0.1,aes(fill = count) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_distiller(palette = "YlOrRd",direction= 1) +
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("low")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r echo=FALSE, message=FALSE, warning= FALSE}
ggplot()+
  geom_sf(data = map_data_high,colour = "gray60",size = 0.1,aes(fill = count) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_distiller(palette = "YlOrRd",direction= 1) +
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("high")+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=FALSE, message=FALSE, warning= FALSE}
map_data_all$count_new<-cut(map_data_all$count
                            ,breaks=c(-Inf,200,400,600,800,1000,Inf)
                            ,labels = c(
                              "[0,200 )"
                              ,"[200,400)"
                              ,"[400,600)"
                              ,"[600,800)"
                              ,"[800,1000)"
                              ,"[1000+)"
                              
                            ))
ggplot()+
  geom_sf(data = map_data_all,colour = "gray60",size = 0.1,aes(fill = count_new) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_brewer(palette = "YlOrRd")+
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("All year")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r echo=FALSE, message=FALSE, warning= FALSE}
map_data_winter$count_new<-cut(map_data_winter$count
                            ,breaks=c(-Inf,50,100,150,200,250,300,Inf)
                            ,labels = c(
                              "[0,50 )"
                              ,"[50,100)"
                              ,"[100,150)"
                              ,"[150,200)"
                              ,"[200,250)"
                              ,"[250,300)"
                              ,"[300+)"
                              
                              
                            ))

plotwin<-ggplot()+
  geom_sf(data = map_data_winter,colour = "gray60",size = 0.1,aes(fill = count_new) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_brewer(palette = "YlOrRd")+
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("Winter")+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=FALSE, message=FALSE, warning= FALSE}
plotsum<- map_data_summer$count_new<-cut(map_data_summer$count
                            ,breaks=c(-Inf,50,100,150,200,250,300,Inf)
                            ,labels = c(
                              "[0,50 )"
                              ,"[50,100)"
                              ,"[100,150)"
                              ,"[150,200)"
                              ,"[200,250)"
                              ,"[250,300)"
                              ,"[300+)"
                              
                            ))

plotsum<-ggplot()+
  geom_sf(data = map_data_summer,colour = "gray60",size = 0.1,aes(fill = count_new) )+
  # scale_fill_continuous(low = "#FF9797", high = "#600000",na.value="white")+
  scale_fill_brewer(palette = "YlOrRd")+
  #scale_fill_manual(palette = "YlOrRd")+
  theme( axis.ticks=element_blank(), 
         axis.title=element_blank(), 
         panel.border = element_blank(), 
         axis.text=element_blank() , 
         panel.background = element_blank()
         
  )+ggtitle("Summer")+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=FALSE, message=FALSE, warning= FALSE}
min(ds$temp)
median(ds$temp)
max(ds$temp)

```
```{r echo=FALSE, message=FALSE, warning= FALSE}
combined_plot_1 <-  plotsum + plotwin
combined_plot_1
```

