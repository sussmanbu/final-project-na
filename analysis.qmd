---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
editor: 
  markdown: 
    wrap: 72
---

![](https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg)

This comes from the file `analysis.qmd`.

We describe here our detailed data analysis. This page will provide an
overview of what questions you addressed, illustrations of relevant
aspects of the data with tables and figures, and a statistical model
that attempts to answer part of the question. You'll also reflect on
next steps and further analysis.

The audience for this page is someone like your class mates, so you can
expect that they have some level of statistical and quantitative
sophistication and understand ideas like linear and logistic regression,
coefficients, confidence intervals, overfitting, etc.

While the exact number of figures and tables will vary and depend on
your analysis, you should target around 5 to 6. An overly long analysis
could lead to losing points. If you want you can link back to your blog
posts or create separate pages with more details.

The style of this paper should aim to be that of an academic paper. I
don't expect this to be of publication quality but you should keep that
aim in mind. Avoid using "we" too frequently, for example "We also found
that ...". Describe your methodology and your findings but don't
describe your whole process.

### Example of loading data

The code below shows an example of loading the loan refusal data set
(which you should delete at some point).

## Note on Attribution

In general, you should try to provide links to relevant resources,
especially those that helped you. You don't have to link to every
StackOverflow post you used but if there are explainers on aspects of
the data or specific models that you found helpful, try to link to
those. Also, try to link to other sources that might support (or refute)
your analysis. These can just be regular hyperlinks. You don't need a
formal citation.

If you are directly quoting from a source, please make that clear. You
can show quotes using `>` like this

```         
> To be or not to be.
```

> To be or not to be.

------------------------------------------------------------------------

## Rubric: On this page

You will

-   Introduce what motivates your Data Analysis (DA)
    -   Which variables and relationships are you most interested in?
    -   What questions are you interested in answering?
    -   Provide context for the rest of the page. This will include
        figures/tables that illustrate aspects of the data of your
        question.
-   Modeling and Inference
    -   The page will include some kind of formal statistical model.
        This could be a linear regression, logistic regression, or
        another modeling framework.
    -   Explain the ideas and techniques you used to choose the
        predictors for your model. (Think about including interaction
        terms and other transformations of your variables.)
    -   Describe the results of your modelling and make sure to give a
        sense of the uncertainty in your estimates and conclusions.
-   Explain the flaws and limitations of your analysis
    -   Are there some assumptions that you needed to make that might
        not hold? Is there other data that would help to answer your
        questions?
-   Clarity Figures
    -   Are your figures/tables/results easy to read, informative,
        without problems like overplotting, hard-to-read labels, etc?
    -   Each figure should provide a key insight. Too many figures or
        other data summaries can detract from this. (While not a hard
        limit, around 5 total figures is probably a good target.)
    -   Default `lm` output and plots are typically not acceptable.
-   Clarity of Explanations
    -   How well do you explain each figure/result?
    -   Do you provide interpretations that suggest further analysis or
        explanations for observed phenomenon?
-   Organization and cleanliness.
    -   Make sure to remove excessive warnings, hide most or all code,
        organize with sections or multiple pages, use bullets, etc.
    -   This page should be self-contained, i.e. provide a description
        of the relevant data.

```{r include=F}
library(dplyr)
library(tidyverse) 
library(ggplot2)
library(viridis)
library(dplyr)
library(kableExtra)
library(ggcorrplot)
library(ggmap)
library(leaflet)

ds <- read_rds("dataset/load_and_clean_data.rds") 
```

## Introduction

From our data page, we know that the Level 3 Assault is the most common
cases in the New York city, so we decide to locate our target on the
Demographic factor and Environmental factor that would effect the
incidents of Level 3 Assault. Through this analysis, We could uncover
correlations that inform targeted interventions, enhance policy-making,
and improve resource allocation. By identifying specific risk factors
related to demographics and environmental conditions, the analysis aims
to guide more effective prevention strategies, optimize urban planning,
and strengthen community engagement and support.

Our team will focus on the analysis of following variables in the
dataset:

-   Demographic factor : Age, Race, Borough

-   Environmental factor: Temperature, wind speed, weather, condition

## Demographic factor

### Age

```{r echo=FALSE, message=FALSE, warning= FALSE}
assault_data <- ds %>%
  filter(grepl("ASSAULT 3 & RELATED OFFENSES", OFNS_DESC)) # Update grepl argument based on how Assault 3 is written in OFNS_DESC

# Create a summary of Assault 3 incidents by age group
assault_age_summary <- assault_data %>%
  group_by(AGE_GROUP) %>%
  summarize(Incident_Count = n())

# Create a bar plot for Assault 3 incidents by age group
ggplot(assault_age_summary, aes(x = AGE_GROUP, y = Incident_Count, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Fig1: Assault 3 Incidents count by Age Group",
       x = "Age Group",
       y = "Incident Count",
       fill = "Age Group") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

From this bar chart, we could know that the distribution of Assault 3
incidents across different age groups in New York City. It highlights
that the age group 25-44 has the highest incidence count, significantly
surpassing other age groups, with the lowest counts observed in the
under-18 and 65+ age brackets. Next we are going to move to gender and
race's relationship with Assault 3 crime rate.

### Gender and Race

```{r echo=FALSE, message=FALSE, warning= FALSE}
assault_3_by_race_gender <- ds %>%
  filter(grepl("ASSAULT 3 & RELATED OFFENSES", OFNS_DESC)) %>%
  count(PERP_RACE, PERP_SEX) %>%
  arrange(n)  

assault_3_by_race_gender |>
  ggplot(aes(x = reorder(PERP_RACE, n), y = n, fill = PERP_SEX)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(x = 'Race', y = 'Incidents Count', title = 'Fig2: Assault 3 Incidents count by Race and Gender', fill = 'Gender') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Blues") 
```

From this graph we could directly find out that males always have higher
number of incidents than female. Also, the highest number of incidents
is associated with Black males, followed by White Hispanic males.

However, it have some **limitations** of this graph. The graph's
representation of Assault 3 incidents by race and gender may be skewed
by reporting biases and systemic disparities in arrest records, as well
as not accounting for the actual demographic distribution of New York
City's population.

#Borough
```{r echo=FALSE, message=FALSE, warning= FALSE}
library(ggplot2)
library(dplyr)

assault_3_by_borough <- ds %>%
  filter(grepl("ASSAULT 3 & RELATED OFFENSES", OFNS_DESC)) %>%
  group_by(ARREST_BORO) %>%
  summarize(Incident_Count = n(), .groups = 'drop') %>%
  mutate(ARREST_BORO = reorder(ARREST_BORO, -Incident_Count), # Reorder in decreasing order
         ARREST_BORO = factor(ARREST_BORO, 
                              levels = rev(levels(ARREST_BORO)),
                              labels = c("Staten Island","Manhattan","Queens","Brooklyn","Bronx"))) # Ensure factor levels are in decreasing order


ggplot(assault_3_by_borough, aes(x = ARREST_BORO, y = Incident_Count, fill = ARREST_BORO)) +
  geom_bar(stat = "identity", width = 0.5, position = "dodge") + # Make bars thinner and horizontal
  coord_flip() +  # Flip coordinates for horizontal bars
  theme_minimal() +
  labs(y = 'Borough', x = 'Number of Assault 3 Incidents', title = 'Assault 3 Incidents by Borough') +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "none") 
```
The graph presents a horizontal bar chart of Assault 3 incidents by borough in New York City, showing Bronx with the highest number of incidents followed by the Brooklyn, Queens, Manhattan, and Staten Island with the fewest. 

In conclusion, by analyzing factors like region, age, and gender, we can establish a general distribution pattern for Level 3 Assault crimes. Subsequently, we will employ regression models to discern whether these factors are correlated with or causative of variations in crime rates. Now, we are moving to the EDA of environmental factors.


#### 底下还没修改

```{r echo =F}
crime_counts_by_day <- ds %>%
  mutate(ARREST_DATE = mdy(ARREST_DATE)) %>%  
  count(ARREST_DATE)  
  
crime_counts_by_month <- crime_counts_by_day %>%
  mutate(Month = floor_date(ARREST_DATE, "month")) %>%
  group_by(Month) %>%
  summarize(Monthly_Crime_Count = sum(n), .groups = "drop")

ggplot(crime_counts_by_month, aes(x = Month, y = Monthly_Crime_Count)) +
  geom_col(fill = "steelblue") +  # Use geom_col for bar charts
  labs(title = "Monthly Crime Counts in 2022 to 2023",
       x = "Month",
       y = "Crime Incidents") +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) 
```

The chart illustrates monthly crime incident counts throughout the year,
with the vertical axis quantifying the incidents from zero to over
20,000. A year-over-year upward trend is observed, with the data
indicating an increase in crime from 2022 to 2023. Specifically, in
2022, the incidents progressively climb from January, peaking in June,
before commencing a downward trajectory from September through December.
Conversely, in 2023, the pattern shows a steady surge in incidents
starting January, reaching its peak in May, followed by a gradual
decline towards December.

```{r echo=FALSE}
# Group by OFNS_DESC and summarize the count
crime_summary <- ds %>%
  group_by(OFNS_DESC) %>%
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10) 

# Create a bar plot
ggplot(crime_summary, aes(x = reorder(OFNS_DESC, Incident_Count), y = Incident_Count)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Top 10 Crime Categories by Incident Count",
       x = "Crime Categories",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The bar chart presents a comparison of incident counts across the top 10
crime categories. The most frequently reported category is "Assault &
Related Offenses," which leads the chart. "Petit Larceny" appears as the
second most prevalent, followed closely by "Dangerous Drugs." The
categories at the lower end of the spectrum, "Dangerous Weapons" and
"Grand Larceny," have the fewest reported incidents among the top 10.

```{r echo=F}
ds|>
ggplot(aes(PERP_RACE)) +
geom_bar(aes(fill = PERP_RACE)) +
theme_minimal() +
labs(x = 'Race', y = 'Number of Cases', title = 'Number of Cases by Race') +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

On this graph we are showing the number of cases per race among all
races. On this graph we can see that the lowest number of cases per race
are represented by the Indian/Alaskan native people. The highest is for
colred people having over 11k cases during this period.

```{r echo= F}
crime_summary <- ds |>
  group_by(OFNS_DESC) |>
  summarize(Incident_Count = n(), .groups = "drop") |>
  arrange(desc(Incident_Count)) |>
  slice_max(Incident_Count, n = 10)

crime_race_summary <- ds |>
  filter(OFNS_DESC %in% crime_summary$OFNS_DESC) |>
  group_by(OFNS_DESC, PERP_RACE) |>
  summarize(Incident_Count = n(), .groups = "drop")

total_counts <- crime_race_summary |>
  group_by(OFNS_DESC) |>
  summarize(Total_Count = sum(Incident_Count), .groups = "drop")

crime_race_summary <- crime_race_summary |>
  left_join(total_counts, by = "OFNS_DESC") |>
  mutate(Proportion = Incident_Count / Total_Count)

ggplot(crime_race_summary, aes(x = reorder(OFNS_DESC, -Proportion), y = Proportion, fill = PERP_RACE)) +
  geom_bar(stat = "identity", position = "fill") +  # Using 'fill' to show proportions
  labs(title = "Proportion of Top 10 Crime Categories by Race",
       x = "Crime Categories",
       y = "Proportion",
       fill = "Race") +
  theme_grey() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = rel(0.8) ))

```

This bar chart illustrates the racial composition of crime across ten
categories, with the green segment indicating a dominant proportion of
Black individuals in every category, followed by White Hispanics,
represented by the pink segment. The smallest proportions are
contributed by Asian/Pacific Islanders and American Indian/Alaskan
Natives, shown in orange and red. This visualization provides a
proportional breakdown by race, with each color-coded segment
corresponding to the percentage of total incidents attributed to that
racial group, reflecting the diversity and potential disparities within
crime statistics.

```{r include=FALSE}
ds
```

```{r echo=F}
# Group by OFNS_DESC and PERP_SEX, and summarize the count
crime_summary <- ds %>%
  group_by(OFNS_DESC) %>%
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10) 

# Group by OFNS_DESC and PERP_SEX, and summarize the count
crime_gender_summary <- ds %>%
  filter(OFNS_DESC %in% crime_summary$OFNS_DESC) %>%
  group_by(OFNS_DESC, PERP_SEX) %>%
  summarize(Incident_Count = n()) 


# Calculate the total count for each crime category
total_counts <- crime_gender_summary %>%
  group_by(OFNS_DESC) %>%
  summarize(Total_Count = sum(Incident_Count))

# Calculate the proportion for each gender within each category
crime_gender_summary <- crime_gender_summary %>%
  left_join(total_counts, by = "OFNS_DESC") %>%
  mutate(Proportion = Incident_Count / Total_Count)

# Create a bar plot
ggplot(crime_gender_summary, aes(x = reorder(OFNS_DESC, Proportion), y = Proportion, fill = PERP_SEX)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Proportion of Top 10 Crime Categories by Gender",
       x = "Crime Categories",
       y = "Proportion",
       fill = "Gender") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The stacked bar chart visualizes the proportions of the top 10 crime
categories distributed by gender, distinguishing between female (F),
male (M), and unspecified (U). It's apparent that male-associated
incidents dominate each crime category, with a markedly higher
proportion compared to females and unspecified genders across the board.
Notably, crimes associated with "Dangerous Drugs," "Felony Assault," and
"Robbery" show a substantial majority of male involvement. This chart
effectively conveys the gender distribution within these crime
categories but does not provide the actual number of incidents or
contextual background that might explain the observed gender
differences.

```{r echo= F}
crime_summary <- ds %>%
  group_by(OFNS_DESC) %>% 
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10)

# Group by OFNS_DESC and PERP_SEX, and summarize the count
crime_gender_summary <- ds %>%
  filter(OFNS_DESC %in% crime_summary$OFNS_DESC) %>%
  group_by(OFNS_DESC, PERP_SEX) %>%
  summarize(Incident_Count = n()) 

# Create a bar plot
ggplot(crime_gender_summary, aes(x = reorder(OFNS_DESC, Incident_Count), y = Incident_Count, fill = PERP_SEX)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Incidents in Top 10 Crime Categories by Gender",
       x = "Crime Categories",
       y = "Incident Count",
       fill = "Gender") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

This graph displays a breakdown of crime incidents by gender across
different categories, with green bars representing males, red bars for
females, and blue bars for unknown gender. A striking feature of the
chart is the predominance of green bars (male incidents), which are
consistently the highest in every crime category, indicating a higher
number of male-associated incidents in these categories. The most
significant numbers of incidents for both males and females are recorded
in "PETIT LARCENY" and "ASSAULT 3 & RELATED OFFENSES." Incidents with an
unknown gender, represented by blue bars, are the lowest across all
categories, suggesting that gender data is more often available than
not. The overall trend suggests that while crime affects all genders,
males are associated with a higher number of incidents in the data
represented.

```{r echo =F}
ds |>
  ggplot(aes(x = LAW_CAT_CD, fill = LAW_CAT_CD)) +
  geom_bar() + 
  theme_minimal() +
  labs(
    x = 'Type of Crime', 
    y = 'Number of Cases', 
    title = 'Number of Cases by Crime Category',
    fill = 'Crime Category'  # Change legend title
  ) +
  scale_x_discrete(labels = c("F" = "Felony", "M" = "Misdemeanor", "V" = "Violation", "I"= "Infraction")) + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The bar chart displays the frequency of various crime types, categorized
as Felony, Infraction, Misdemeanor, and Violation. The vertical axis
indicates the number of cases, while the horizontal axis lists the crime
categories. Misdemeanor appears to be the most common, followed by
felonies. The crime incidents of infraction and violation are the least
with small numbers of cases.

```{r echo =F}
crime_summary <- ds %>%
  group_by(LAW_CAT_CD) %>%
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10)

# Group by LAW_CAT_CD and AGE_GROUP, and summarize the count
crime_gender_summary <- ds %>%
  filter(LAW_CAT_CD %in% crime_summary$LAW_CAT_CD) %>%
  group_by(LAW_CAT_CD, AGE_GROUP) %>%
  summarize(Incident_Count = n())
# Create a bar plot
ggplot(crime_gender_summary, aes(x = reorder(LAW_CAT_CD,Incident_Count), y=    
                                 Incident_Count, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Incidents in General crime Categories by Age",
       x = "General crime Categories",
       y = "Incident Count",
       fill = "Age") +
  theme_minimal() +
  scale_x_discrete(labels = c("F" = "Felony", "M" = "Misdemeanor", "V" = "Violation", "I"= "Infraction"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The bar chart shows the distribution of crime incidents across different
categories—Infraction, Violation, Felony, and Misdemeanor—segregated by
age groups. The graph illustrates that the 25-44 age group has the
highest incidence of felonies, a significant number of misdemeanors, and
relatively lower counts for infractions and violations, suggesting this
age range is the most involved in crime. The other age groups contribute
fewer incidents across all categories, with the least involvement by
those under 18 and over 65.

```{r echo =F}
crime_summary <- ds %>%
  group_by(OFNS_DESC) %>%
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10)
# Group by OFNS_DESC and AGE_GROUP, and summarize the count
crime_gender_summary <- ds %>%
  filter(OFNS_DESC %in% crime_summary$OFNS_DESC) %>%
  group_by(OFNS_DESC, AGE_GROUP) %>%
  summarize(Incident_Count = n())
  
# Create a bar plot
ggplot(crime_gender_summary, aes(x = reorder(OFNS_DESC, Incident_Count), y = Incident_Count, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Incidents in Top 10 crime Categories by Age",
       x = "crime Categories",
       y = "Incident Count",
       fill = "Age") +
  theme_minimal() +
  
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

This bar chart illustrates the frequency of different crimes for various
age groups. Notably, the 25-44 age group shows the highest incident
counts in every category, while the groups under 18 and over 65 have
significantly fewer incidents across all crime categories.

### RACE

```{r echo=F}
ds|>
ggplot(aes(PERP_RACE)) +
geom_bar(aes(fill = PERP_RACE)) +
theme_minimal() +
labs(x = 'Race', y = 'Number of Cases', title = 'Number of Cases by Race') +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

On this graph we are showing the number of cases per race among all
races. On this graph we can see that the lowest number of cases per race
are represented by the Indian/Alaskan native people. The highest is for
colred people having over 11k cases during this period.

```{r include=FALSE}
ds
```

### Crime Categories

```{r echo =F}
ds |>
  ggplot(aes(x = LAW_CAT_CD, fill = LAW_CAT_CD)) +
  geom_bar() + 
  theme_minimal() +
  labs(
    x = 'Type of Crime', 
    y = 'Number of Cases', 
    title = 'Number of Cases by Crime Category',
    fill = 'Crime Category'  # Change legend title
  ) +
  scale_x_discrete(labels = c("F" = "Felony", "M" = "Misdemeanor", "V" = "Violation", "I"= "Infraction")) + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The bar chart displays the frequency of various crime types, categorized
as Felony, Infraction, Misdemeanor, and Violation. The vertical axis
indicates the number of cases, while the horizontal axis lists the crime
categories. Misdemeanor appears to be the most common, followed by
felonies. The crime incidents of infraction and violation are the least
with small numbers of cases.

### AGE

```{r echo =F}
crime_summary <- ds %>%
  group_by(LAW_CAT_CD) %>%
  summarize(Incident_Count = n()) %>%
  arrange(desc(Incident_Count)) %>%
  top_n(10)

# Group by LAW_CAT_CD and AGE_GROUP, and summarize the count
crime_gender_summary <- ds %>%
  filter(LAW_CAT_CD %in% crime_summary$LAW_CAT_CD) %>%
  group_by(LAW_CAT_CD, AGE_GROUP) %>%
  summarize(Incident_Count = n())
# Create a bar plot

ggplot(crime_gender_summary, aes(x = reorder(LAW_CAT_CD,Incident_Count), y=    
                                 Incident_Count, fill = AGE_GROUP)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Incidents in General crime Categories by Age",
       x = "General crime Categories",
       y = "Incident Count",
       fill = "Age") +
  theme_minimal() +
  scale_x_discrete(labels = c("F" = "Felony", "M" = "Misdemeanor", "V" = "Violation", "I"= "Infraction"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The bar chart shows the distribution of crime incidents across different
categories—Infraction, Violation, Felony, and Misdemeanor—segregated by
age groups. The graph illustrates that the 25-44 age group has the
highest incidence of felonies, a significant number of misdemeanors, and
relatively lower counts for infractions and violations, suggesting this
age range is the most involved in crime. The other age groups contribute
fewer incidents across all categories, with the least involvement by
those under 18 and over 65.
