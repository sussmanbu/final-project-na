---
title: "Regression"
subtitle: ""
author: "TEAM 14"
date: "2024-04-28"
draft: false
---

```{r}
library(tidyverse) 
library(ggplot2)
library(dplyr) 
library(MASS)
ds <- read_rds("dataset/load_and_clean_data.rds") 
```

```{r}
conditions=factor(ds$condition)
age=factor(ds$AGE_GROUP)
sex=factor(ds$PERP_SEX)
race=factor(ds$PERP_RACE)
boro=factor(ds$ARREST_BORO)
temp=ds$temp
windspeed=ds$windspeed
crime=data.frame(conditions,age,sex,race,boro,temp,windspeed)
str(crime)

df_y <- ds %>%
  filter(OFNS_DESC == "ASSAULT 3 & RELATED OFFENSES") %>%
  group_by(temp,conditions,windspeed,AGE_GROUP, PERP_SEX, PERP_RACE, ARREST_BORO) %>%
  summarise(y = n(), .groups = 'drop')



mod <- glm(y ~ temp+conditions+AGE_GROUP+PERP_SEX+PERP_RACE+ARREST_BORO, 
           data = df_y, 
           family = poisson())

# Summary of the model
summary(mod)

```
```{r}
par(mfrow=c(2,2))
plot(mod)
```
```{r}
mod_temp <- glm(y ~ temp, 
           data = df_y, 
           family = poisson())
par(mfrow=c(2,2))
plot(mod_temp)
```
```{r}
mod_temp <- glm(y ~ temp, 
           data = df_y, 
           family=poisson())
summary(mod_temp)
qqnorm(df_y$temp)
qqline(df_y$temp, col = "red")

```

```{r}
qqnorm(df_y$windspeed)
qqline(df_y$windspeed,col="red")
```

```{r}
mod_windspeed <- glm(y ~ windspeed, 
           data = df_y, 
           family="poisson")
summary(mod_windspeed)
par(mfrow=c(2,2))
plot(mod_windspeed)
```

```{r}
with(mod,cbind(res.deviance = deviance, df = df.residual, p=pchisq(deviance, df.residual,lower.tail=FALSE)))
```

```{r}
mod_step = step(mod,direction="both")
```

```{r}
summary(mod_step)
```

```{r}
ggplot(df_y,aes(x = y, color = conditions,fill=conditions))+geom_density(alpha=0.4)
```

```{r}
condition_glm= glm(y~conditions,data=df_y,family=poisson)
summary(condition_glm)
```

```{r}
temp_glm= glm(y~temp+windspeed,data=df_y,family=poisson)
summary(temp_glm)
```

```{r}
df_y$temp_range <- cut(df_y$temp,
                      breaks = c(-Inf, 10, 20, 30, 40, Inf),
                      labels = c("<10", "11-20", "21-30", "31-40", ">40"),
                      include.lowest = TRUE)
df_y$windspeed_range <- cut(df_y$windspeed,
                            breaks = c(-Inf, 10, 20, 30, 40, Inf),
                            labels = c("<10", "11-20", "21-30", "31-40", ">40"),
                            include.lowest = TRUE)
ggplot(df_y, aes(x = y, fill = temp_range)) +
  geom_density(alpha = 0.4) +
  labs(title = "Density of 'y' for Temperature Ranges",
       x = "'y' value",
       fill = "Temperature Range")
ggplot(df_y, aes(x = y, fill = windspeed_range)) +
  geom_density(alpha = 0.4) +
  labs(title = "Density of 'y' for Wind Speed Ranges",
       x = "'y' value",
       fill = "Wind Speed Range")

```

```{r}
temp_glm= glm(y~windspeed_range,data=df_y,family=poisson)
summary(temp_glm)
```



